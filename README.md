# Awesome Task Exchange System (aTES) для UberPopug Inc

Практическая часть [курса](https://education.borshev.com/architecture).

## Задачи по домашнему заданию на нулевую неделю

* &#9745; Смириться с абсурдом топ-менеджмента UberPopug Inc. Прочитать требования. Если что-то непонятно — пишите на почту support@tough-dev.school. 
* &#9745; Создать репозиторий в гитхабе, пригласить туда f213 и davydovanton. Ссылку на созданный репозиторий приcлать на support@tough-dev.school или в чатик на сайте (синий кружок с сердечком в правом нижнем углу). Не забудьте указать емейл, на который покупали курс, чтобы мы поняли, кто вы такой.
* &#9745; Создайте черновой проект системы так, как вы видите её сейчас, до старта обучения. Не заморачивайтесь с проработкой, не бойтесь ошибиться — мы это делаем, чтобы вы в конце обучения сравнили «было» и «стало».
* &#9744; Подойдёт любой инструмент для рисования квадратиков, к примеру LucidChart или Miro + текст о том, как это потенциально работает. Писать код НЕ нужно. Минимальные требования к проекту:
* &#9745; Выбрать сервисы, минимально должно быть 2+ сервисов — мы всё-таки асинхронную архитектуру делаем. Желательно обосновать почему были выбраны именно такие сервисы. И чем каждый должен заниматься.
  ```
  Сделал 4 сервиса:
  1) Аудита/Аналитики. Будет агрегировать статистику по дням
  2) Авторизации. Будет управлять пользователями и их разрешениями в сервисах. Заниматься авторизацией, выпуском и обновлением токенов
  3) Биллинга. Будет работать со счетами работяг, рассчитывать итоги дня
  4) Трекер задач. Будет вести учет задач
  ТЗ само подсказывает границы сервисов. Выбирались с проверкой могут ли быть пересечения в ответственности и смогу ли я их порешать не нарушая границы
  ```
* &#9745; Описать коммуникации между сервисами — вид (синхронный\асинхронный) и данные которые будут передаваться в коммуникациях (хватит основных полей, детали в духе id, created_at и прочие технические поля можно опустить).
  ```
  С синхронным я уже достаточно наработал опыта, думаю выберу полностью асинхронный на пробу. 
  Если где-то будет нужен синхронный (вероятно процесс авторизации и получения токена), воспользуюсь им.
  1) Для доступа в сервисы нужна будет аутентификация с авторизацией. Обеспечиваться будет токеном. 
  В токене будет передаваться [guid, role], токен будет подписываться. 
  Секретный ключ и алгоритм дешифрации будет расшарен между остальными сервисами. Токен будет jwt на 5 минут
  2) Инициатором всей движухи будет трекер, а именно кнопка распределения задач. 
  Перед доступом в трекер будет расшифрован токен и проверена роль. При взаимодействии с трекером будут генерироваться события
  и отправляться в кафку/кролик, где соответствующие каналы будут слушать другие заинтересованные сервисы.
  При взаимодействии с кнопкой связывания задач будут генерироваться события assignedTask(userGuid, taskId)
  При завершение задачи событие CompletedTask(userGuid, taskId)
  При создании задачи CreatedTask(userGuid, taskId)
  3) события assignedTask, CompletedTask, CreatedTask будут слушаться в биллинг сервисе и проводиться списания и пополнения счета, вестись лог транзакций
  В биллинг сервисе будет запускаться задача по крону, либо демон который будет начинать работу ночью. 
  Обработчик расчитает результаты дня и отправит письма (создаст файлы с письмами) с зарплатой и обнулит счет, либо перенесёт на следующий день долг
  По завершению создаст событие с отчетом за день dayResult(maxCostTask, taskCountProfit, taskCountDeficit, income) и опубликует его
  4) событие dayResult будет слушать сервис статистики и сохранять к себе
  ```
* &#9745; Описать как решать проблемы, которые могут возникнуть с данными. Что делать, если упадет сеть, база данных и так далее.
  ``` 
  1) Можно позаботиться о репликации и подмене падающих мастеров на резервные. 
  2) Можно предусмотреть несколько транспортов и в случае недоступности одного из них воспользоваться следующим из доступных. 
  3) В случае падения сетевой связности можно падающие события складывать в локальное хранилище и проигрывать повторно при появлении связности.
  ```
* &#9745; Описать спорные места и (или) места, которые вам кажутся критичными на данный момент.
  ```
  1) сервис биллинга и аудита/статистики могут пересекаться. Потому что при изменение запросов со стороны сервиса статистики 
  нельзя будет моментально перестоить запеченные данные для отчетов и возможно потребуется дополнительная возня для раскрытия этих данных из биллинг сервиса
  2) токен на клиенте надо будет обновлять каждые 5 минут, с простым клиентом это может стать проблемой
  3) пункт 5d будет проблемой если задачи будут распределяться долго, а это скорей всего будет дольше, чем желание покликать для теста :) Нужны будут блокировки, либо блокирующая очередь
  ```

## Задачи по домашнему заданию на первую неделю

  > [схема](./docs/index.md)
* &#9744; Положить все, что вы сделали к нулевому уроку в отдельную папку или отдельный файл. Нам важно сохранить все так как есть сейчас, что бы вернуться к этому проектированию в конце курса для сравнения как было в начале и как получилось в конце. Сейчас мы спроектируем ту же систему по новой, используя подходы из курса. А в следующих неделях реализуем то, что будем сейчас проектировать.
* &#9745; Разобрать каждое требование на составляющие (актор, команда, событие, query). Определить, как все бизнес цепочки будут выглядеть и на какие шаги они будут разбиваться.
* &#9745; Построить модель данных для системы и модель доменов. Рисовать можно в любом удобном инструменте (включая обычную бумагу), главное, чтобы это было не только у вас в голове, но и где-то вовне. Благодаря этому вы сможете сфокусироваться на отдельной части системы, не думая о других. А также показать свое решение одногрупникам/коллегам.
* &#9745; Определить, какие общие данные нужны для разных доменов и как связаны данные между разными доменами.
* &#9745; Разобраться, какие сервисы, кроме тудушника, будут в нашей системе и какие между ними могут быть связи (как синхронные, так и асинхронные).
* &#9745; Определить все бизнес события, необходимые для работы системы. Отобразить кто из сервисов является продьюсером, а кто консьюмером бизнес событий.
* &#9745; Выписать все CUD события и какие данные нужны для этих событий, которые необходимы для работы системы. Отобразить кто из сервисов является продьюсером, а кто консьюмером CUD событий.
